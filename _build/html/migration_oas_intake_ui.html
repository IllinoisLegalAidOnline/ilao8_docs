

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>OTIS Intake UI and Pre-Transfer &mdash; ILAO Drupal 8 3.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Exit screens and Callbacks" href="migration_oas_callbacks_and_confirms.html" />
    <link rel="prev" title="Intake Availability Functions" href="migration_oas_intake_available.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ILAO Drupal 8
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="migration.html">Migration Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="migration_users.html">Users and user profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_org_data.html">Migrating Organization Data</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="migration_otis_entities.html">OTIS-related migration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="migration_oas_intake_settings.html">OAS Intake Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_triage_user.html">OAS Triage User</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_referral_history.html">OAS Referral History</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_legal_server.html">OAS Legal Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_financial_category.html">ILAO OAS Financial Category</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_income_standard.html">ILAO OAS Income Standard</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="migration_otis_functionality_overview.html">OTIS Functionality Documentation</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="migration_oas_functionality.html">OTIS Global Items</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_permissions.html">Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_cron.html">OTIS Scheduled Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_glh.html">Get Legal Help Form to Next Step</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_intake_available.html">Intake Availability Functions</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">OTIS Intake UI and Pre-Transfer</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_callbacks_and_confirms.html">Exit screens and Callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_etransfer.html">OTIS eTransfer Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_notifications.html">OTIS Automated Notifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_triage_rules.html">Triage Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_referrals.html">OTIS Referrals</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_popup.html">OTIS Modal</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_widget.html">OTIS Widget</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_surveys.html">OTIS Surveys</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_reporting.html">OTIS Reporting Functionality</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="otis_drupal8.html">OTIS Drupal 8</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ILAO Drupal 8</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="migration.html">Migration Documentation</a> &raquo;</li>
        
          <li><a href="migration_otis_entities.html">OTIS-related migration</a> &raquo;</li>
        
          <li><a href="migration_otis_functionality_overview.html">OTIS Functionality Documentation</a> &raquo;</li>
        
      <li>OTIS Intake UI and Pre-Transfer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/migration_oas_intake_ui.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="otis-intake-ui-and-pre-transfer">
<h1>OTIS Intake UI and Pre-Transfer<a class="headerlink" href="#otis-intake-ui-and-pre-transfer" title="Permalink to this headline">¶</a></h1>
<p>When a user reaches intake, after completing a program’s triage rules successfully, they complete a series of forms to collect additional information.</p>
<div class="section" id="application-form">
<h2>Application form<a class="headerlink" href="#application-form" title="Permalink to this headline">¶</a></h2>
<p>Location: oas_triage_user.application_form.inc</p>
<p>The main get-legal-help/intake form is a multi-page form and what pages display to a user depends on the intake settings. An error is thrown if there is  no session variable for the triage id.</p>
<p>The form consists of:
* The first page that collects name, date of birth, and demographics.  These are defined in the oas_triage_user_application_form.
* A page to collect household size
* Pages to collect financial information</p>
<p>The oas_triage_user_application_form_validate manages form validation and invokes specific validation on each page’s submission.</p>
<p>The contact form and callback selection form are separate forms.</p>
<div class="section" id="invokes-and-requires">
<h3>Invokes and Requires<a class="headerlink" href="#invokes-and-requires" title="Permalink to this headline">¶</a></h3>
<p>Invokes hook_form
Requires:</p>
<ul class="simple">
<li>ilao_triage</li>
<li>Session variable containing the current intake settings id</li>
</ul>
</div>
<div class="section" id="first-page-of-the-form">
<h3>First page of the form<a class="headerlink" href="#first-page-of-the-form" title="Permalink to this headline">¶</a></h3>
<p>The first page of the form is defined in the oas_triage_user_application_form form.</p>
<div class="section" id="form-elements">
<h4>Form Elements<a class="headerlink" href="#form-elements" title="Permalink to this headline">¶</a></h4>
<p>Note that the select taxonomy require oas_triage_user_load_intake_taxonomy to load the options.  For fields marked “only displays if enabled,” these only display if the intake settings are configured to collect the field.  When collected, the help text is pulled from the intake settings.</p>
<p>The Select country requires the locale module to load Drupal’s country list.</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Form variable</th>
<th class="head">Type</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>settings_id</td>
<td>hidden</td>
<td>the session intake settting</td>
</tr>
<tr class="row-odd"><td>about_you</td>
<td>field set</td>
<td>Just a label</td>
</tr>
<tr class="row-even"><td>first_name</td>
<td>text field</td>
<td>User’s first name</td>
</tr>
<tr class="row-odd"><td>middle_name</td>
<td>text field</td>
<td>User’s middle name</td>
</tr>
<tr class="row-even"><td>last_name</td>
<td>text field</td>
<td>User’s last name</td>
</tr>
<tr class="row-odd"><td>maiden_name</td>
<td>text field</td>
<td>User’s maiden name</td>
</tr>
<tr class="row-even"><td>nickname</td>
<td>text field</td>
<td>User’s nickname(s)</td>
</tr>
<tr class="row-odd"><td>date_of_birth</td>
<td>date or text field</td>
<td>If date module exists,
separate month, day, year
elements; goes back 110 yrs</td>
</tr>
<tr class="row-even"><td>race</td>
<td>select taxonomy</td>
<td>Only displays if enabled</td>
</tr>
<tr class="row-odd"><td>ethnicity</td>
<td>select taxonomy</td>
<td>Only displays if enabled</td>
</tr>
<tr class="row-even"><td>gender</td>
<td>select taxonomy</td>
<td>Only displays if enabled</td>
</tr>
<tr class="row-odd"><td>marital_status</td>
<td>select taxonomy</td>
<td>Only displays if enabled</td>
</tr>
<tr class="row-even"><td>country</td>
<td>select country</td>
<td>Only displays if enabled</td>
</tr>
<tr class="row-odd"><td>language</td>
<td>select taxonomy</td>
<td>Only displays if enabled</td>
</tr>
<tr class="row-even"><td>immigration</td>
<td>select taxonomy</td>
<td>Only displays if enabled</td>
</tr>
<tr class="row-odd"><td>citizenship</td>
<td>select taxonomy</td>
<td>Only displays if enabled</td>
</tr>
<tr class="row-even"><td>current_client</td>
<td>checkbox</td>
<td>Is user current client for
same problem?</td>
</tr>
<tr class="row-odd"><td>applied</td>
<td>checkbox</td>
<td>Has user applied for same
problem?</td>
</tr>
<tr class="row-even"><td>current_client_different</td>
<td>checkbox</td>
<td>Is user current client w/
a different problem?</td>
</tr>
<tr class="row-odd"><td>never_client</td>
<td>checkbox</td>
<td>Has user never been a
client of organization z</td>
</tr>
<tr class="row-even"><td>prisoner</td>
<td>checkbox</td>
<td>Is user in jail or prison?
Only asked if needed</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="validation">
<h4>Validation<a class="headerlink" href="#validation" title="Permalink to this headline">¶</a></h4>
<p>The global validation function:</p>
<ul class="simple">
<li>Invokes the page 1 submit function (oas_triage_user_submit_page1)</li>
<li>Updates the current page in the form state array</li>
<li>Stores the first page’s data in the form state array</li>
<li>Drupal’s own validation handles the required field validation.</li>
</ul>
</div>
<div class="section" id="submit-handler">
<h4>Submit handler<a class="headerlink" href="#submit-handler" title="Permalink to this headline">¶</a></h4>
<p>Displays an error message if</p>
<ul class="simple">
<li>the user has indicated that they are a current client</li>
<li>the user has indicated that they have already applied</li>
<li>the user has indicated that they are in jail or prison and the intake settings does not allow prisoners to apply online</li>
<li>the user is younger than the minimum age to apply online.</li>
</ul>
<p>If an error message is displayed, the user is not allowed to proceed to the second page.</p>
<p>The _oas_triage_user_get_user_age private function takes the user’s date of birth to calculate their age.</p>
<p>Invokes oas_triage_user_save_demographics to save demographic data.</p>
</div>
<div class="section" id="saving-entity-data-from-page-1">
<h4>Saving entity data from page 1<a class="headerlink" href="#saving-entity-data-from-page-1" title="Permalink to this headline">¶</a></h4>
<p>The oas_triage_user_save_demographics function loads the current triage entity and updates:</p>
<ul class="simple">
<li>the last screen viewed to “Intake start”</li>
<li>the intake status to “Started”</li>
<li>the intake_changed time to the current timestamp</li>
<li>the user’s age</li>
<li>the user’s various demographic properties, if collected:<ul>
<li>gender</li>
<li>race</li>
<li>ethnicity</li>
<li>marital_status</li>
<li>citizenship_status</li>
<li>immigration_status</li>
<li>primary language</li>
<li>country of origin</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="household-size-page">
<h3>Household size page<a class="headerlink" href="#household-size-page" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id1">
<h4>Form Elements<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="33%" />
<col width="33%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Form variable</th>
<th class="head">Type</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>description</td>
<td>markup</td>
<td>From intake settings, the
program’s definition of who
is in the household</td>
</tr>
<tr class="row-odd"><td>household_size</td>
<td>markup</td>
<td>Heading label</td>
</tr>
<tr class="row-even"><td>adults</td>
<td>integer</td>
<td>Number of adults; required</td>
</tr>
<tr class="row-odd"><td>children</td>
<td>integer</td>
<td>Number of kids; required</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id2">
<h4>Validation<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>This page has a custom validate function, oas_triage_user_validate_household.</p>
<p>Validation requires that:</p>
<ul class="simple">
<li>Number of adults is a positive integer or empty</li>
<li>Number of children is a positive integer or empty</li>
<li>Total number of adults and children is at least 1</li>
</ul>
</div>
<div class="section" id="submission">
<h4>Submission<a class="headerlink" href="#submission" title="Permalink to this headline">¶</a></h4>
<p>This page has a custom submit function, oas_triage_user_submit_household.</p>
<p>Upon submission, the triage user entity is updated:</p>
<ul class="simple">
<li>to set the number of household_adults</li>
<li>to set the number of household_children</li>
<li>sets the intake_changed property to the current timestamp</li>
<li>changes the last screen viewed to “Intake household”</li>
</ul>
</div>
</div>
<div class="section" id="financial-pages">
<h3>Financial Pages<a class="headerlink" href="#financial-pages" title="Permalink to this headline">¶</a></h3>
<p>The financial form pages depend on the financial settings in the relevant intake_settings entity.  Programs may collect:</p>
<ul class="simple">
<li>income</li>
<li>assets</li>
<li>expenses</li>
<li>expenses only if the user appears to be over-income</li>
<li>nothing at all</li>
</ul>
<p>If intake settings are configured to not collect any financial information, the user’s application is then processed.</p>
<p>The oas_triage_user_get_next_screen function determines which form page to show:
* From household size, show income if income needs collected
* From household size, process if no income, assets, or expenses need collected
* From income page, show assets if assets need collected
* From income page, show expenses if assets are not collected but expenses are
* From income page, show expenses if assets are not collected, expenses are only collected if the user is over-income and the user appears to be over-income
* From income page, go to done if no assets or expenses need collected
* From asset page, show expenses if expenses are generally collected
* From asset page, show expenses if  expenses are only collected if the user is over-income and the user appears to be over-income
* From asset page, go to done if no expenses need collected
* From expense page, go to done</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It appears that if income is not collected, assets and expenses can not be collected either.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There was agreement in the evaluation meeting to remove some of the financial pages across programs.</p>
</div>
<div class="section" id="building-the-form">
<h4>Building the form<a class="headerlink" href="#building-the-form" title="Permalink to this headline">¶</a></h4>
<p>The form is built in the oas_triage_user_ask_financial function
Located: oas_triage_user.application_form.inc</p>
<p>Parameters:</p>
<ul class="simple">
<li>$form =&gt; the form</li>
<li>$terms =&gt; the financial taxonomy terms to collect</li>
<li>$category =&gt; a string (expense types, assets, income sources)</li>
<li>$suffix =&gt; a label to append to the end of the help description (per month, total, etc)</li>
<li>$progress =&gt; the progress percentage to display in the progress form</li>
</ul>
<p>Form elements:</p>
<p>With this information, the ask_financial function builds a form that:</p>
<ul class="simple">
<li>adds a description header, with the number of household members</li>
<li>loops through each taxonomy term and loads the related ilao_oas_financial_category entity</li>
<li>builds field groups for each unique subcategory of financial categories</li>
<li>adds each financial category item as a field within the correct field group</li>
<li>each term is:<ul>
<li>required</li>
<li>named a variation of the taxonomy term name that is lowercase and spaces replaced with underscores.  For example Checking account becomes named checking_account.</li>
<li>prefixed with a $</li>
<li>any suffix is added</li>
<li>help text from the entity is added</li>
<li>a textfield</li>
<li>required to be an integer</li>
<li>defaults to 0</li>
</ul>
</li>
</ul>
<p>Form validation:</p>
<ul class="simple">
<li>The _oas_triage_user_validate_financial validates each item to ensure it is a positive integer or 0</li>
</ul>
</div>
<div class="section" id="saving-financial-data">
<h4>Saving Financial Data<a class="headerlink" href="#saving-financial-data" title="Permalink to this headline">¶</a></h4>
<p>Each type category of financial data has its own save function.</p>
<p>Income:  oas_triage_user_save_income, which:</p>
<ul class="simple">
<li>Loads the triage user entity</li>
<li>Sets the last screen viewed to “Income questions”</li>
<li>Adds up all the income amounts and stores it in the total income property</li>
<li>Updates the intake changed timestamp to the current timestamp</li>
<li>Saves the triage user entity</li>
</ul>
<p>Assets:  oas_triage_user_save_assets, which:</p>
<ul class="simple">
<li>Loads the triage user entity</li>
<li>Sets the last screen viewed to “Assets questions”</li>
<li>Adds up all the income amounts and stores it in the total assets property</li>
<li>Updates the intake changed timestamp to the current timestamp</li>
<li>Saves the triage user entity</li>
</ul>
<p>Expenses:  oas_triage_user_save_expenses, which:</p>
<ul class="simple">
<li>Loads the triage user entity</li>
<li>Sets the last screen viewed to “Expense questions”</li>
<li>Adds up all the expense amounts and stores it in the total expenses property</li>
<li>Updates the intake changed timestamp to the current timestamp</li>
<li>Saves the triage user entity</li>
</ul>
</div>
</div>
</div>
<div class="section" id="calculating-financial-eligibility">
<h2>Calculating Financial Eligibility<a class="headerlink" href="#calculating-financial-eligibility" title="Permalink to this headline">¶</a></h2>
<div class="section" id="income-eligibility">
<h3>Income eligibility<a class="headerlink" href="#income-eligibility" title="Permalink to this headline">¶</a></h3>
<p>The oas_triage_user_calculate_income_eligibility calculates income eligiblity.  Income eligibility is generally determined by looking at the total income minus countable expenses against a maximum percentage of an income standard based on household size.</p>
<div class="section" id="parameters">
<h4>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h4>
<p>Requires:  intake settings entity, count expenses boolean (Default is true)
Returns: boolean value “is user income eligible?”</p>
</div>
<div class="section" id="process">
<h4>Process<a class="headerlink" href="#process" title="Permalink to this headline">¶</a></h4>
<p>Returns true if income is not collected.  For all other cases:</p>
<ul class="simple">
<li>Invokes oas_triage_user_check_for_exemption to see if income is waived for the user</li>
<li>Calculates the total household size</li>
<li>Adds up all the entered income fields and multiplies by 12 to get annual income</li>
<li>If expenses can be offset against income:<ul>
<li>Adds up all collected expenses</li>
<li>Multiplies expenses by 12</li>
</ul>
</li>
<li>If expenses are not available to offset income, set total expenses to 0</li>
<li>Sets the total income for eligibility to income - assets with a minimum income of 0</li>
<li>Loads the ilao_income_standard used in the intake settings as the income standard to apply</li>
<li>Calculates the correct annual amount by:<ul>
<li>For households with 8 or fewer members, taking that amount from the income standards entity</li>
<li>For households with more than 8 members, taking the amount for 8 members and adding the additional member amount * the number of additional members</li>
<li>Determines the maximum allowed income based on the percentage allowed in the intake settings</li>
<li>Returns true if the user is not over income and eligible for services</li>
<li>Returns false if the user is over income and not eligible</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="asset-eligibility">
<h3>Asset eligibility<a class="headerlink" href="#asset-eligibility" title="Permalink to this headline">¶</a></h3>
<p>The oas_triage_user_calculate_asset_eligibility calculates asset eligiblity.  Asset eligiblity is generally calculated by adding up all countable assets and comparing that against a maximum asset dollar limit.  Some programs exclude a dollar amount for personal property in adding up assets.</p>
<div class="section" id="id3">
<h4>Parameters<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Requires:  intake settings entity,
Returns: boolean value “is user asset eligible?”</p>
</div>
<div class="section" id="id4">
<h4>Process<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Adds up all the asset items</li>
<li>If personal property is collected and there is a dollar exemption for personal property, the total assets are reduced (but not by more than the amount of personal property) by the exemption amount.  For example:<ul>
<li>if total assets are $5000, personal property is $2000 and the personal property exemption is $8500, total assets of $3000 would be counted.</li>
<li>if total assets are $10000, personal property is $9000 and the personal property exemption is $8500, total assets of $1500 would be counted.</li>
</ul>
</li>
<li>Pulls the maximum allowed assets tied to the intake settings</li>
<li>If the total countable assets are less than the maximum allowed, returns TRUE (user is asset eligible)</li>
<li>If the total countable assets are equal to or more than the maximum allowed, returns FALSE (user is not asset eligible)</li>
</ul>
</div>
</div>
<div class="section" id="final-processing">
<h3>Final processing<a class="headerlink" href="#final-processing" title="Permalink to this headline">¶</a></h3>
<p>The application submit function then:
* Updates the overincome property in the triage user entity to 3 if the user is over asset, 2 if the user is over-income  If a user is both over income and over asset, the status is set to 3.</p>
<p>If a user is financially ineligible, they are redirected to referrals.  If they are eligible, they are taken to the contact form.</p>
</div>
</div>
<div class="section" id="contact-form">
<h2>Contact form<a class="headerlink" href="#contact-form" title="Permalink to this headline">¶</a></h2>
<p>The address form can be found in the oas_triage_user.address_form.inc file. The oas_triage_user_client_address_form function generates the form.</p>
<p>Requires that the session triage ID be defined.</p>
<div class="section" id="id5">
<h3>Form elements<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<div class="section" id="default-form-elements">
<h4>Default form elements<a class="headerlink" href="#default-form-elements" title="Permalink to this headline">¶</a></h4>
<p>The oas_triage_user module generates the default address form.  Other modules, as always in Drupal, can alter that form</p>
<table border="1" class="docutils">
<colgroup>
<col width="33%" />
<col width="33%" />
<col width="35%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Form variable</th>
<th class="head">Type</th>
<th class="head">Notes</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>callback_type</td>
<td>hidden</td>
<td>the callback type from the
associated intake settings</td>
</tr>
<tr class="row-odd"><td>client_telephone</td>
<td>text field</td>
<td>telephone field</td>
</tr>
<tr class="row-even"><td>client_email</td>
<td>text field</td>
<td>field for email address</td>
</tr>
<tr class="row-odd"><td>client_address_street</td>
<td>text field</td>
<td>field for line 1 of address</td>
</tr>
<tr class="row-even"><td>client_address_street2</td>
<td>text field</td>
<td>field for line 2 of address</td>
</tr>
<tr class="row-odd"><td>client_city</td>
<td>text field</td>
<td>field for city</td>
</tr>
<tr class="row-even"><td>client_state</td>
<td>text field</td>
<td>field for state</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="form-alters">
<h3>Form alters<a class="headerlink" href="#form-alters" title="Permalink to this headline">¶</a></h3>
<p>The ilao_sms_opt_in module alters this form.  It:</p>
<ul class="simple">
<li>add a custom submit handler (ilao_oas_triage_sms_opt_in_submit)</li>
<li>adds a custom validation function (ilao_oas_triage_sms_opt_in_validate)</li>
<li>attaches the oas_triage_user form; this is the form that makes up the Get Legal Help form</li>
<li>it hides the Get Legal Help form elements</li>
<li>it makes the opt_in_sms field visible on the form</li>
<li>it adds the following:<ul>
<li>a select form element to set phone type; if the phone type is mobile, the opt in sms form element displays using conditional fields.</li>
</ul>
</li>
</ul>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Evaluate if all of this was really necessary of whether the OTIS platform should support SMS out of the box.</p>
</div>
</div>
<div class="section" id="id6">
<h3>Validation<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The default validation function (oas_triage_user_client_address_form_validate) validates the form to:</p>
<ul class="simple">
<li>ensure that the email is valid</li>
<li>ensure that the phone number is valid</li>
<li>ensure that the phone number is less than 20 characters.  This is a limitation on the eTransfer as Legal Server will not accept phone number fields larger than 20 characters.</li>
<li>ensures that the zip code is less than 10 characters</li>
</ul>
<p>The ilao_oas_triage_sms_opt_in_validate adds validation to ensure that if the phone type is mobile the field_opt_in_sms is required.</p>
</div>
<div class="section" id="submit-functions">
<h3>Submit functions<a class="headerlink" href="#submit-functions" title="Permalink to this headline">¶</a></h3>
<p>The default submit function (oas_triage_user_client_address_form_submit):
* Updates session data with the user’s email, phone, and address.  We do not store this information unserialized in our database.
* Checks the callback type to set the form redirect to the right page:</p>
<blockquote>
<div><ul class="simple">
<li>If callback type is please call, sets the redirect to get-legal-help/please-call.</li>
<li>If callback type is we call client:<ul>
<li>Sets the redirect to get-legal-help/callback-form if there are callback hours available</li>
<li>Sets the redirect to get-legal-help/please-call if there are no callback hours.</li>
</ul>
</li>
</ul>
</div></blockquote>
<ul class="simple">
<li>Calls the oas_triage_user_save_address_data to save the appropriate data.</li>
</ul>
<div class="section" id="oas-triage-user-save-address-data">
<h4>oas_triage_user_save_address_data<a class="headerlink" href="#oas-triage-user-save-address-data" title="Permalink to this headline">¶</a></h4>
<p>Updates the triage user entity to:</p>
<ul class="simple">
<li>Set the last screen viewed to ‘Address Form’</li>
<li>Set the intake changed timestamp to the current timestamp</li>
<li>Saves the changes to the database</li>
</ul>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">The default submit function also stores the email address into a session variable for Acquia Lift.  This should be extracted into its own unrelated module to keep this clean.</p>
</div>
<p>The ilao_oas_triage_sms_opt_in_submit updates the triage user entity to:</p>
<ul class="simple">
<li>store the user’s mobile phone to the field_mobile_phone</li>
<li>stores the user’s SMS opt in settings to the field_opt_in_sms</li>
<li>saves the entity</li>
</ul>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="migration_oas_callbacks_and_confirms.html" class="btn btn-neutral float-right" title="Exit screens and Callbacks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="migration_oas_intake_available.html" class="btn btn-neutral" title="Intake Availability Functions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ILAO.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>