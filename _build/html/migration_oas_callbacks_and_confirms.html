

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Exit screens and Callbacks &mdash; ILAO Drupal 8 3.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="OTIS eTransfer Processing" href="migration_oas_etransfer.html" />
    <link rel="prev" title="OTIS Intake UI and Pre-Transfer" href="migration_oas_intake_ui.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> ILAO Drupal 8
          

          
          </a>

          
            
            
              <div class="version">
                3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="migration.html">Migration Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="migration_users.html">Users and user profiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="migration_org_data.html">Migrating Organization Data</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="migration_otis_entities.html">OTIS-related migration</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="migration_oas_intake_settings.html">OAS Intake Settings</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_triage_user.html">OAS Triage User</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_referral_history.html">OAS Referral History</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_legal_server.html">OAS Legal Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_financial_category.html">ILAO OAS Financial Category</a></li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_income_standard.html">ILAO OAS Income Standard</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="migration_otis_functionality_overview.html">OTIS Functionality Documentation</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="migration_oas_functionality.html">OTIS Global Items</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_permissions.html">OTIS Permissions</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_cron.html">OTIS Scheduled Tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_glh.html">Get Legal Help Form to Next Step</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_intake_available.html">Intake Availability Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_intake_ui.html">OTIS Intake UI and Pre-Transfer</a></li>
<li class="toctree-l4 current"><a class="current reference internal" href="#">Exit screens and Callbacks</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_etransfer.html">OTIS eTransfer Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_notifications.html">OTIS Automated Notifications</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_triage_rules.html">Triage Rules</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_referrals.html">OTIS Referrals</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_popup.html">OTIS Modal</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_widget.html">OTIS Widget</a></li>
<li class="toctree-l4"><a class="reference internal" href="migration_oas_surveys.html">OTIS Surveys</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="migration_oas_reporting.html">OTIS Reporting Functionality</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="otis_drupal8.html">OTIS Drupal 8</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ILAO Drupal 8</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="migration.html">Migration Documentation</a> &raquo;</li>
        
          <li><a href="migration_otis_entities.html">OTIS-related migration</a> &raquo;</li>
        
          <li><a href="migration_otis_functionality_overview.html">OTIS Functionality Documentation</a> &raquo;</li>
        
      <li>Exit screens and Callbacks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/migration_oas_callbacks_and_confirms.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="exit-screens-and-callbacks">
<h1>Exit screens and Callbacks<a class="headerlink" href="#exit-screens-and-callbacks" title="Permalink to this headline">¶</a></h1>
<p>Exit screen functionality is largely within tihe oas_triage_user.exits.inc file.</p>
<p>There are six exit screens:</p>
<ul class="simple">
<li>Callback select form</li>
<li>Callback confirmation page</li>
<li>Please call us confirmation page</li>
<li>Failure page</li>
<li>Bypass intake page</li>
<li>Referrals page</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The bypass intake page is only ever called when processing triage rules and the user hits a bypass end point.  See the triage rules section for details on this exit screen.
The referrals is only generated if a user is directed to referrals.  See the referrals page for more details.</p>
</div>
<div class="section" id="template-files">
<h2>Template files<a class="headerlink" href="#template-files" title="Permalink to this headline">¶</a></h2>
<p>Each page (not the select form) has a template file provided in the module that can be themed per the usual Drupal theme layer.  The 4 template files are:</p>
<ul class="simple">
<li>oas–bypass.tpl.php</li>
<li>oas–please-call.tpl.php</li>
<li>oas–referrals.tpl.php</li>
<li>oas–we-call-you.tpl.php</li>
</ul>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">in an ideal world, the template files would have been themed in ILAO’s theme folder rather than in the module.</p>
</div>
</div>
<div class="section" id="please-call-page">
<h2>Please call page<a class="headerlink" href="#please-call-page" title="Permalink to this headline">¶</a></h2>
<p>The please call page is displayed when:</p>
<ul class="simple">
<li>the callback type is “client calls</li>
<li>the user selects “none of these times work for me” on the callback select form</li>
<li>the callback type is “we call client” but there are no callback slots available.</li>
</ul>
<p>and the etransfer was successful (see the oas_triage_user_please_call function)</p>
<p>If the etransfer_status was already set when this page is built, the user will see a message that their application was already submitted and it will not resubmit it.</p>
<p>The page is built by the oas_triage_user_build_please_call_page function.</p>
<div class="section" id="oas-triage-user-build-please-call-page">
<h3>oas_triage_user_build_please_call_page<a class="headerlink" href="#oas-triage-user-build-please-call-page" title="Permalink to this headline">¶</a></h3>
<p>Located in: oas_triage_user.exits.inc</p>
<div class="section" id="parameters">
<h4>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h4>
<p>Requires: the intake settings ID of the intake settings used to generate the application
Returns: a render array</p>
</div>
<div class="section" id="process">
<h4>Process<a class="headerlink" href="#process" title="Permalink to this headline">¶</a></h4>
<p>In building the page the function:
* invokes the oas_triage_user_save_exit to save the last screen viewed as Please call and set the intake status to eTransferred.
* Loads the organization name
* Sets the page title
* Builds out the content array for the template file:</p>
<blockquote>
<div><ul class="simple">
<li>Call label (hand-coded in the module)</li>
<li>Contact label</li>
<li>Call message from the intake settings (requires token_replace to replace OAS tokens with values</li>
<li>Steps (loads the steps from the oas_triage_user_get_steps function</li>
<li>Adds the steps image</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="oas-triage-user-save-exit">
<h3>oas_triage_user_save_exit<a class="headerlink" href="#oas-triage-user-save-exit" title="Permalink to this headline">¶</a></h3>
<p>Located in: oas_triage_user.exits.inc</p>
<div class="section" id="id1">
<h4>Parameters<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Requires:</p>
<ul class="simple">
<li>exit type; string to populate last screen viewed</li>
<li>transfer type; string to populate the intake status.</li>
</ul>
<p>Returns:  null</p>
</div>
<div class="section" id="id2">
<h4>Process<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>Updates the triage user entity to:</p>
<ul class="simple">
<li>set the last screen viewed to the exit type parameter</li>
<li>set the intake status to the transfer type parameter</li>
<li>set the intake changed timestamp to the current timestamp</li>
<li>saves the changes to the database</li>
</ul>
</div>
</div>
<div class="section" id="oas-triage-user-get-steps">
<h3>oas_triage_user_get_steps<a class="headerlink" href="#oas-triage-user-get-steps" title="Permalink to this headline">¶</a></h3>
<p>Generates the steps array to be included in the render array for the page.</p>
<div class="section" id="id3">
<h4>Parameters<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>Requires:</p>
<ul class="simple">
<li>the organization name</li>
<li>the contact type string (“please_call”, etc)</li>
</ul>
<p>Returns a render array element that includes:</p>
<ul class="simple">
<li>the #theme type of item_list</li>
<li>an empty tite</li>
<li>the class</li>
<li>the array of items in the list</li>
</ul>
</div>
</div>
</div>
<div class="section" id="callback-selection-form">
<h2>Callback Selection Form<a class="headerlink" href="#callback-selection-form" title="Permalink to this headline">¶</a></h2>
<p>The callback selection form is displayed when:</p>
<ul class="simple">
<li>the callback type is “we call client”</li>
<li>there are callback times available to display</li>
</ul>
<p>oas_triage_user_callback_form builds the form.
_oas_triage_user_get_callback_options builds the list of callback option times.</p>
<div class="section" id="getting-callback-times">
<h3>Getting callback times<a class="headerlink" href="#getting-callback-times" title="Permalink to this headline">¶</a></h3>
<p>The private _oas_triage_user_get_callback_options function generates the list of callback times.
Located in oas_triage_user.exits.inc</p>
<div class="section" id="id4">
<h4>Parameters<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h4>
<p>Accepts an intake_settings entity
Returns an array of callback options for use in a checkbox form element.</p>
</div>
<div class="section" id="id5">
<h4>Process<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Determines the start date available for next callback slot.  This is either:<ul>
<li>2 days from the current day</li>
<li>3 days from the current day if it is a Saturday</li>
</ul>
</li>
<li>Builds an array of days from the start date going to the next 15 days.</li>
<li>For each day in the array:<ul>
<li>Gets the field name where the callback slots are stored.  This is determined by taking the lower case of the day of the week and appending it to oas_callback_hours.</li>
<li>Invokes oas_triage_user_is_holiday to determine if the day is a holiday</li>
<li>If there are callback hours and it is not a holiday, builds the time slot options for that day by:<ul>
<li>Loading the taxonomy term that represents the hour slot</li>
<li>Checking to see if the time slot is full</li>
<li>If the time slot is not full, creates an option element for the checkbox element</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Is the time slot full?  Programs currently can limit the number of callbacks that can be scheduled in a slot at either the intake setting or service level.  Service level is most common.  This requires then that we check the total number of callbacks for given slot to determine if the max has been reached. If the max has been reached, the time slot is not available for booking.</p>
</div>
<div class="admonition-todo admonition" id="index-1">
<p class="first admonition-title">Todo</p>
<p class="last">Consider reducing the number of days where callbacks are offered
Consider allowing programs to set their own additional holidays.
Consider refactoring to break this down further.</p>
</div>
</div>
</div>
<div class="section" id="displaying-the-form">
<h3>Displaying the form<a class="headerlink" href="#displaying-the-form" title="Permalink to this headline">¶</a></h3>
<p>oas_triage_user_callback_form defines the form.
Located in: oas_triage_user.exits.inc</p>
<div class="section" id="id6">
<h4>Process<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Invokes the oas_triage_user_save_exit function to update the triage user information.</li>
<li>Determines the maximum number of options the user can pick.  By default, that number is 3 but the program may have defined a different number in their service.</li>
<li>Builds the form with elements for:<ul>
<li>Callback times, as a list of checkboxes</li>
<li>A single checkbox to indicate that none of the times work for them</li>
<li>A hidden value of for the maximum slots</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="processing-the-form">
<h3>Processing the form<a class="headerlink" href="#processing-the-form" title="Permalink to this headline">¶</a></h3>
<p>oas_triage_user_callback_form_submit validates and submits the form.</p>
<div class="section" id="id7">
<h4>Process<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>If the user has picked more time slots than allowed, an error is displayed and the user must reduce the number of selections before proceeding.</li>
<li>If the user has indicated that none of the times work for them, they are redirected to the get-legal-help/please-call confirmation</li>
<li>Otherwise:<ul>
<li>The system invokes oas_triage_user_save_callback_times to save the selected callback times</li>
<li>Redirects the user to the get-legal-help/callback-confirm page.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="oas-triage-user-save-callback-times">
<h4>oas_triage_user_save_callback_times<a class="headerlink" href="#oas-triage-user-save-callback-times" title="Permalink to this headline">¶</a></h4>
<p>Located in: oas_triage_user.exits.inc</p>
<ul class="simple">
<li>Updates the field_triage_callback_times associated with the triage user with an array of callback times.</li>
<li>Invokes oas_triage_user_save to save the triage user with updated information.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="callback-confirmation-page">
<h2>Callback Confirmation Page<a class="headerlink" href="#callback-confirmation-page" title="Permalink to this headline">¶</a></h2>
<p>The callback confirmation page is displayed when:</p>
<ul class="simple">
<li>the callback type is “we call client”</li>
<li>the user selects at least one callback time</li>
</ul>
<p>See also:  <a class="reference external" href="migration_oas_intake_ui.html">Contact form submission in</a></p>
<p>and the etransfer was successful (see the oas_triage_user_please_call function)</p>
<p>If the etransfer_status was already set when this page is built, the user will see a message that their application was already submitted and it will not resubmit it.</p>
</div>
<div class="section" id="bypass-intake-page">
<h2>Bypass Intake Page<a class="headerlink" href="#bypass-intake-page" title="Permalink to this headline">¶</a></h2>
<p>The bypass intake page appears when the end point in the triage rules is set to bypass. The function oas_triage_user_bypass builds the bypass page and the oas–bypass.tpl.php file displays the page.</p>
<div class="section" id="oas-triage-user-bypass">
<h3>oas_triage_user_bypass<a class="headerlink" href="#oas-triage-user-bypass" title="Permalink to this headline">¶</a></h3>
<p>Located in oas_triage_user.exits.inc</p>
<div class="section" id="id8">
<h4>Process<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li>Loads the intake settings associated with the triage</li>
<li>Loads the organization’s name</li>
<li>Build the content render array:<ul>
<li>call_header is empty</li>
<li>If the program has defined a bypass message to display, sets the call_msg to that message, replacing any tokens for OAS:name with the organization name and the OAS:phone with the callback number.</li>
<li>If the program has not defined a bypass message, provides a generic message that uses the default organization name and callback number.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<div class="section" id="saving-the-triage-exit-to-the-triage-object">
<h2>Saving the triage exit to the triage object<a class="headerlink" href="#saving-the-triage-exit-to-the-triage-object" title="Permalink to this headline">¶</a></h2>
<p>oas_triage-user_save_exit
Located in: oas_triage_user.exits.inc</p>
<div class="section" id="id9">
<h3>Parameters<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>Requires an exit type and a transfer type as strings</p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="31%" />
<col width="31%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Page</th>
<th class="head">Exit type</th>
<th class="head">Transfer type</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>callback-form</td>
<td>Callback form</td>
<td>Started</td>
</tr>
<tr class="row-odd"><td>callback-confirm</td>
<td>Callback confirm</td>
<td>eTransferred</td>
</tr>
<tr class="row-even"><td>please-call</td>
<td>Please call</td>
<td>Not eTransferred</td>
</tr>
</tbody>
</table>
<p>For a user accessing the callback form, the exit type is Callback form and transfer type is started.</p>
</div>
<div class="section" id="id10">
<h3>Process<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>Updates the triage user entity to:</p>
<ul class="simple">
<li>set the last screen viewed to the exit type</li>
<li>set the intake status to the transfer type</li>
<li>set the intake changed to the current timestamp</li>
<li>saves the triage user entity by invoking oas_triage_user_save</li>
</ul>
<div class="admonition-todo admonition" id="index-2">
<p class="first admonition-title">Todo</p>
<p class="last">Unclear if bypass sets an exit type.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="migration_oas_etransfer.html" class="btn btn-neutral float-right" title="OTIS eTransfer Processing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="migration_oas_intake_ui.html" class="btn btn-neutral" title="OTIS Intake UI and Pre-Transfer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, ILAO.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'3.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>